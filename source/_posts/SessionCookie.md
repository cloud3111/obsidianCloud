---
title: 会话存储技术
tags:
  - session
  - cookie
categories: 编程
date: 2024-12-28 18:16:14
---

# 会话存储技术

## 本地/会话存储

| 对比维度           | `localStorage`                                                 | `sessionStorage`                                                  |
| -------------- | -------------------------------------------------------------- | ----------------------------------------------------------------- |
| **存储方式**       | 键值对（Key-Value）                                                 | 键值对（Key-Value）                                                    |
| **容量限制**       | 一般为 **5MB**                                                    | 一般为 **5MB**                                                       |
| **生命周期**       | 持久存储，除非手动清除或代码删除，否则长期存在                                        | 仅在 **当前标签页/会话** 存活，关闭标签页即清除                                       |
| **作用范围**       | 同源下的所有窗口和标签页共享                                                 | 仅限当前标签页，不能跨窗口共享                                                   |
| **是否随请求自动发送**  | ❌ 不会                                                           | ❌ 不会                                                              |
| **是否可被 JS 访问** | ✅ 可以（易受 **XSS** 攻击）                                            | ✅ 可以（易受 **XSS** 攻击）                                               |
| **安全性**        | 数据明文存储，无加密，容易被 XSS 读取                                          | 数据明文存储，无加密，容易被 XSS 读取                                             |
| **适用场景**       | - 长期保存用户登录状态（token，除非安全要求高）- 长期保存用户配置（比如主题、语言偏好）- 防止页面刷新导致数据丢失 | - 保存一次会话内的临时数据（表单数据、步骤状态）- 用户信息（userInfo）- 缓存静态 HTML 或请求结果以减少重复请求 |
| **清除方式**       | 手动清除缓存 / JS 调用 `localStorage.clear()` 或 `removeItem()`         | 关闭标签页 / JS 调用 `sessionStorage.clear()` 或 `removeItem()`           |

## Cookie存储
- **特点**：
  - 每次 HTTP 请求时自动携带到服务器。
  - 数据存储大小限制约为 4KB, 容量较小
  - 支持设置过期时间，数据可以是会话级别(也就是Session级别)或持久化。
  - 支持 `HttpOnly` 和 `Secure` 标志以提升安全性。
  - 用户身份验证（如存储登录标识: token）->> 用cookie存储token易受csrf攻击

![17353826990101735382698082.png|701x412](https://fastly.jsdelivr.net/gh/cloud3111/cloudWallpaper@main/17353826990101735382698082.png)
## Session
- Session的存储离不开Cookie, 都是依存于请求头的

| 维度         | 内容                                                                                                                    |
| ---------- | --------------------------------------------------------------------------------------------------------------------- |
| **存储位置**   | 服务器端（内存、文件或外部存储如 Redis）                                                                                               |
| **标识方式**   | **Session ID**，通常存储在 **Cookie** 中，也可通过 URL 参数传递                                                                       |
| **生命周期**   | 与用户会话相关：- 用户关闭浏览器- 会话超时- 手动销毁- 后端心跳检测                                                                                 |
| **客户端依赖**  | 客户端必须携带 Session ID 才能与服务器匹配会话数据                                                                                       |
| **数据存储容量** | 存储在服务器端，用户量大时可能占用大量内存或存储                                                                                              |
| **安全性**    | 数据不暴露在客户端（比 localStorage/cookie 安全），但 Session ID 泄露可能导致会话劫持                                                           |
| **分布式处理**  | - **Sticky Session（ip_hash）**：请求固定路由到同一服务器- **Session 复制**：多服务器同步 Session 数据- **集中式存储（Redis）**：所有服务器统一访问同一 Session 存储 |
### 工作原理(Websocket)
1. **首次访问**
    - 服务器生成唯一 **Session ID**。
    - 返回客户端，通常放在 Cookie 中：`Set-Cookie: JSESSIONID=xxx; Path=/; HttpOnly`。
    - 服务器将 Session 数据存入 `SessionMap` 或 Redis。
2. **后续请求**
    - 客户端自动携带 **Session ID**（Cookie 或 URL）。
    - 服务器通过 `SessionMap.get(SessionID)` 获取对应会话数据。
    - 可以读取或更新会话数据。
3. **更新 & 销毁**
    - 开发者可向会话存储数据。
    - 会话超时或用户登出时，服务器清理会话数据。
## Session和Cookie的区别
- 作用范围不同，Cookie 保存在客户端(浏览器)，Session 保存在服务器端。
- 存取方式的不同，Cookie只能保存 ASCII，Session可以存任意数据类型，比如UserId等。
- 有效期不同，Cookie可设置为长时间保持，比如默认登录功能功能，Session一般有效时间较短，客户端关闭或者Session超时都会失效。
- 隐私策略不同，Cookie存储在客户端，信息容易被窃取;Session存储在服务端，相对安全一些。
- 存储大小不同， 单个Cookie 保存的数据不能超过 4K，Session可存储数据远高于Cookie。

![17353838920091735383891446.png|700x276](https://fastly.jsdelivr.net/gh/cloud3111/cloudWallpaper@main/17353838920091735383891446.png)
