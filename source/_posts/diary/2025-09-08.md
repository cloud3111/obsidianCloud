# 优化简历实习经历部分

**保险模块**
- 7种保单状态   0待支付, 1已过期, 2未开始，3保障中,  4已退保,  5投保中,  6承保失败
1. 第三方保险公司会给一个对接文档, 标注了投保接口所需要的请求参数和响应参数 
	- 投保人姓名, 身份证类型和号码, 手机号, 店铺地址, 投保时间
	- 流水号(biz_order_sn: 结合Redis确保投保订单的幂等性)
	- 保险产品代码
	- 白鸽订单号(num_id), 也叫保单号
	- 异步通知回调地址(`return_url`),支付成功跳转地址 
	- 起保时间, 终保时间, 保单状态, 投保金额
2. 店铺是否满足投保条件(店铺订单总数是否达标), 包括对投保状态的判断, 首年免费(施工完成后推送, 开店后的总销售金额要超过1000)
3. 定时任务检测保险单状态 保障中和未支付的订单  第二天自动批量更新数据库
4. 统一处理 重试(报500错误后的重试) 幂等(biz_order 保证一个订单不会被多次扣费) 异常(统一异常处理, 手动tryCatch) 

**烟柜模块**
	useTobaccoCabine字段用来判断商户是否有烟柜  用getByType查询设备表是否有烟柜
	用户在进行扫码开门时需要进行未成年判断, 推送消息到用户; 在后台操作继电器开门ioTAmqpSDK.pub(deviceName, request) - > 发送iot设备消息(IoTAmqpClientUtil： 阿里云物联网平台 > 开发参考 > AMQP客户端开发指南)
	增加了多人情况下烟草柜状态的判断和处理, 进入新用户时先检查柜子状态, 有提示但是直接让下一个人使用
	还需要针对特定的设备做不同的推送, 阿里云泥人, 锐益达
```sql
# channelType 7为烟柜  通过equipment_id相连
SELECT erc.*,e.equipment_type, e.equipment_serial FROM kj_equipment_relay_channel erc  
LEFT JOIN kj_equipment e ON e.id = erc.equipment_id  
WHERE e.merchant_id = #{merId}  
  AND erc.channel_type = 7LIMIT 1
```

**物联网设备:**
	Iot设备和Sip设备都是互联网设备, 但是Sip设备主要用于麦克风对讲和视频, Iot设备则是更多用于需要控制设备状态的, 同步设备状态的电器,门锁, 传感器
	Iot设备有一个EquipmentRelayChannel实体类, channelStatus(通道状态(0-锁门 1-开门 2-离线))
	一个设备（`kj_equipment`）可能有多个继电器通道（`kj_equipment_relay_channel`）:比如一台智能门锁主机，可以挂前门锁、后门锁、麦克风等多个通道 


**稽查任务**: 识别顾客是否有拿烟这个动作场景
	personCigaretteResult -> 人工判断是否拿烟
	aiCigaretteResult -> AI辅助判断是否拿烟
	isPrecise -> 判断是否精准

	稽查任务的分发: 一个定时任务, 将稽查任务分发给对应的稽查客服
	
	提供接口给大模型, 分为获取待分配/待处理任务以及提交对任务的判断结果
	
		AI判断  ——┐
		           ├——> 比对结果 ——> 是否精准？ ——> 入库
		人工判断 ——┘
		
		定时任务 ——> 拉取未分配任务 ——> 分配客服 ——> 更新任务状态
		
		大模型接口 ——> 获取任务 ——> 返回判断 ——> 入库/复核
